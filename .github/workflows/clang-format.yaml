name: Clang Format Check

on:
  pull_request:
    branches: [master]
  push:
    branches: [master]

jobs:
  clang-format-check:
    name: Check code formatting
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5.0.0
        with:
          fetch-depth: 0

      - name: Install clang-format
        run: |
          sudo apt-get update
          sudo apt-get install -y clang-format

      - name: Check code formatting
        run: |
          find . -name "*.cpp" -o -name "*.h" -o -name "*.hpp" -o -name "*.cc" -o -name "*.cxx" | \
          grep -v -E "(build/|third_party/|vendor/)" | \
          xargs clang-format --dry-run --Werror --ferror-limit=1
